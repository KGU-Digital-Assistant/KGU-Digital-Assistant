from typing import List

from sqlalchemy import desc

from models import User, Track
from sqlalchemy.orm import Session
from domain.track.track_schema import TrackCreate, TrackSchema


def track_create(db: Session, user: User):
    db_track = Track(user_id=user.id)
    db.add(db_track)
    db.commit()
    return db_track


# 이름 track 찾기
def track_update(db: Session, _track_id: int, user: User, _track: TrackCreate):
    track = db.query(Track).filter(Track.id == _track_id).first()
    if (track is None):
        return None
    if (track.user_id != user.id):
        return None

    track.water = _track.water or track.water
    track.coffee = _track.coffee or track.coffee
    track.alcohol = _track.alcohol or track.alcohol
    track.duration = _track.duration
    track.track_yn = _track.track_yn
    db.commit()
    db.refresh(track)
    return track


def get_tracks_by_track_name(db: Session, track_name: str, skip: int = 0, limit: int = 10):
    query = db.query(Track).filter(Track.name.contains(track_name)).order_by(desc(Track.name))
    count = query.count()
    tracks = query.offset(skip).limit(limit).all()
    return count, tracks


def get_track_by_id(db: Session, track_id: int):
    return db.query(Track).filter(Track.id == track_id).first()


############################################


def get_Track_by_user_id(db: Session, user_id:int):
    tracks = db.query(Track).filter(
        Track.user_id == user_id
    ).first()
    return tracks
